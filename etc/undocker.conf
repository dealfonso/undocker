#
# undocker - unprivileged Docker containers
# Copyright (C) - 
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
# http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
#

# 
# IMPORTANT: this file MUST not be writable by arbitrary users
#
[main]
# "main" section corresponds to the settings for the undocker application

# In case that a flag/parameter is blacklisted, setting ERROR_ON_BLACKLISTED to "true" will
#   make that the run will fail. Otherwise, the blacklisted command will simply skipped
ERROR_ON_BLACKLISTED=true

# The path for the docker application (if not set, it will be assumed that it is in the path)
DOCKERPATH=

# This is the definition of the whitelisted parameters. The syntax is a comma separated list
#   of parameter definition:
#       --flag|-F|-f <paramname1> <paramname2> ... 
#   When parsing the parameters, each option will be tested and undocker will skip as many
#   parameters as <paramname1> strings.
#       e.g.
#           -l|--log-level string
#         will accept both "undocker -l debug" and "undocker --log-level debug"
WHITELIST="--config string", \
"-D|--debug", \
"--help", \
"-H|--host list", \
"-l|--log-level string", \
"--tls", \
"--tlscacert string", \
"--tlscert string", \
"--tlskey string", \
"--tlsverify", \
"-v|--version"

# This is the definition of the blacklisted parameters. That means that if used when running
#   undocker, these parameters will not be included in the final call to docker. The BLACKLIST
#   option has precedence over WHITELIST. That means that if one parameter appear in the BLACKLIST
#   it will not appear in the final call even if it appears in the WHITELIST.
#
#   The syntax is the same than in the WHITELIST parameter.
BLACKLIST=

# The commands that are accepted to be ran are included as sections in the form [command:<commandname>]
#   Some examples are [command:exec] or [command:run]. If a command does not appear as a section, it
#   will not be permitted
#
# In each command definition, it is possible to include the following vars:
#   WHITELIST, BLACKLIST, FORCED, UIDMUSTMATCH
# 
# Parameters WHITELIST and BLACKLIST have the same meaning and syntax explained in the [main] section
#   but applied to the specific command.
#
# > FORCED is the commandline that is forced to appear in the final call after the parameters included
#   by the user in the undocker call.
#
#     e.g. FORCED=-u $UID:GID in [command:run] will make that when the user issues the command
#            undocker run --rm -it alpine
#          will make that the finall call will look like
#            docker run --rm -it -u $UID:$GID alpine
#
# > UIDMUSTMATCH=true makes a prior check to execute the docker command. If the user does not own the
#   container (i.e. has not been ran using the -u parameter), the user cannot operate on the container.
#   The name of the container is assumed to be the first non-parameter after the command.
#   
#     warning: if the container name is not expected to be the this option should not be used.
#

# -----------------------------------------------------------------------------------------------------
# Definition of a set of commands to enable common users to run docker
# -----------------------------------------------------------------------------------------------------
[command:exec]
WHITELIST=--help,-i|--interactive,-t|--tty,-v|--volume list
FORCED=-u $UID:$GID

[command:run]
WHITELIST=--help,-i|--interactive,-t|--tty,-d|--detach,--rm,-e|--env list,-v|--volume list,-w|--workdir string,--name string
FORCED=-u $UID:$GID -v $PWD:$PWD:ro

[command:ps]
WHITELIST=--help,-q|--quiet,-a|--all,-f|--filter filter,--format string,-n|--last int,-l|--latest,--no-trunc,-s|--size

[command:inspect]
WHITELIST=--help,-f|--format string,-s|--size,--type string
UIDMUSTMATCH=true

[command:stop]
WHITELIST=--help,-t|--time int
UIDMUSTMATCH=true

[command:rm]
WHITELIST=-f|--force,--help,-l|--link,-v|--volumes
UIDMUSTMATCH=true
